# 内存管理

## 虚拟内存

### 内存分段

定义：程序是由若干个逻辑分段组成，如代码分段、数据分段、栈段、堆段等。不同的段有不同的属性，所以就用分段的形式把这些段分离出来。

分段机制下，虚拟地址由两部分组成， **段选择子** 和 **段内偏移量** 。

![image-20220620140748317](E:\lcsprogram\study_doc\操作系统\image\内存分段示意图.png)

分段的方法解决了程序本身不关心具体物理内存地址的问题，但是有一些不足之处：

- 内存碎片问题
  - 外部内存碎片，产生了多个不连续的小物理内存，导致新的程序无法被装载（一般解决方案为内存交换）
  - 内部内存碎片，程序所有的内存都被装载到物理内存，但是这个程序有部分内存可能并不是很常使用，这也会导致内存浪费
- 内存转换效率低问题

### 内存分页

分页是把整个虚拟和物理内存空间切成一段段固定尺寸的大小。这样一个连续并且尺寸固定的内存空间，叫做**页**。在linux下，每一页的大小为 **4KB**

![image-20220620142026631](E:\lcsprogram\study_doc\操作系统\image\内存分页索引图.png)

内存转换三个步骤：

- 把虚拟内存地址，切分成页号和偏移量
- 根据页号，从页表里面，查询对应的物理页号
- 直接拿物理页号，加上前面的偏移量，得到物理地址。

### 多级页表

![image-20220620142534202](E:\lcsprogram\study_doc\操作系统\image\多级页表索引图.png)